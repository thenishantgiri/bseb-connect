{
  "info": {
    "name": "BSEB Connect - Complete API with Twilio",
    "description": "Complete API collection for BSEB Connect with Twilio OTP integration",
    "_postman_id": "bseb-complete-2024",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Twilio OTP",
      "item": [
        {
          "name": "Send OTP (SMS)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 201\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test(\"OTP sent successfully\", function () {",
                  "    pm.expect(response).to.have.property('success');",
                  "    if (response.success) {",
                  "        pm.expect(response).to.have.property('identifier');",
                  "        pm.expect(response).to.have.property('channel');",
                  "        console.log('OTP sent to: ' + response.identifier);",
                  "        pm.environment.set('last_identifier', pm.variables.get('test_phone'));",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Set a test phone number if not already set",
                  "if (!pm.environment.get('test_phone')) {",
                  "    pm.environment.set('test_phone', '9876543210');",
                  "}",
                  "",
                  "console.log('Sending OTP to: ' + pm.environment.get('test_phone'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_phone}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/send-otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "send-otp"
              ]
            },
            "description": "Send OTP via SMS using Twilio Verify"
          },
          "response": []
        },
        {
          "name": "Send OTP (WhatsApp)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 201\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test(\"WhatsApp OTP sent\", function () {",
                  "    if (response.success) {",
                  "        pm.expect(response.channel).to.equal('whatsapp');",
                  "        console.log('WhatsApp OTP sent to: ' + response.identifier);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_phone}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/send-otp/whatsapp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "send-otp",
                "whatsapp"
              ]
            },
            "description": "Send OTP via WhatsApp using Twilio"
          },
          "response": []
        },
        {
          "name": "Verify OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test(\"OTP verified successfully\", function () {",
                  "    pm.expect(response).to.have.property('success');",
                  "    ",
                  "    // Save tokens if provided",
                  "    if (response.access_token) {",
                  "        pm.environment.set('access_token', response.access_token);",
                  "        console.log('Access token saved');",
                  "    }",
                  "    if (response.refresh_token) {",
                  "        pm.environment.set('refresh_token', response.refresh_token);",
                  "        console.log('Refresh token saved');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Use test OTP if in development mode",
                  "if (!pm.environment.get('otp_code')) {",
                  "    pm.environment.set('otp_code', '123456');",
                  "}",
                  "",
                  "console.log('Using OTP: ' + pm.environment.get('otp_code'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_phone}}\",\n  \"otp\": \"{{otp_code}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/verify-otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "verify-otp"
              ]
            },
            "description": "Verify the OTP code sent via SMS/WhatsApp"
          },
          "response": []
        },
        {
          "name": "Resend OTP (SMS)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_phone}}\",\n  \"channel\": \"sms\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/resend-otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "resend-otp"
              ]
            },
            "description": "Resend OTP via SMS"
          },
          "response": []
        },
        {
          "name": "Resend OTP (Voice Call)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_phone}}\",\n  \"channel\": \"call\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/resend-otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "resend-otp"
              ]
            },
            "description": "Resend OTP via Voice Call"
          },
          "response": []
        },
        {
          "name": "Send OTP (Email)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_email}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/send-otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "send-otp"
              ]
            },
            "description": "Send OTP to email address"
          },
          "response": []
        }
      ],
      "description": "Twilio OTP authentication endpoints"
    },
    {
      "name": "Auth - Traditional",
      "item": [
        {
          "name": "Login with Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "if (response.access_token) {",
                  "    pm.environment.set('access_token', response.access_token);",
                  "    pm.environment.set('refresh_token', response.refresh_token);",
                  "    console.log('Tokens saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login/password",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login",
                "password"
              ]
            },
            "description": "Login with email/phone and password"
          },
          "response": []
        },
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"fullName\": \"New User\",\n  \"mobile\": \"9876543210\",\n  \"role\": \"STUDENT\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            },
            "description": "Register a new user"
          },
          "response": []
        },
        {
          "name": "Forgot Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"{{test_email}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/forgot-password",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "forgot-password"
              ]
            },
            "description": "Request password reset"
          },
          "response": []
        }
      ],
      "description": "Traditional authentication endpoints"
    },
    {
      "name": "User",
      "item": [
        {
          "name": "Get Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "if (response.id) {",
                  "    pm.environment.set('user_id', response.id);",
                  "    console.log('User ID: ' + response.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/profile",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "users",
                "profile"
              ]
            },
            "description": "Get current user profile"
          },
          "response": []
        },
        {
          "name": "Update Profile",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Updated Name\",\n  \"mobile\": \"9876543210\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/users/profile",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "users",
                "profile"
              ]
            },
            "description": "Update user profile"
          },
          "response": []
        }
      ],
      "description": "User management endpoints",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{access_token}}",
            "type": "string"
          }
        ]
      },
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "Health Check",
      "item": [
        {
          "name": "API Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"API is running\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 1000ms\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}",
              "host": [
                "{{base_url}}"
              ]
            },
            "description": "Check if API is running"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Test Flow",
      "item": [
        {
          "name": "Complete OTP Flow Test",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// This will run the complete OTP flow",
                  "console.log('Starting complete OTP flow test...');",
                  "",
                  "// Set test phone",
                  "const testPhone = pm.environment.get('test_phone') || '9876543210';",
                  "pm.environment.set('test_phone', testPhone);",
                  "",
                  "console.log('Test phone: ' + testPhone);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Step 1: Send OTP",
                  "const sendOtpRequest = {",
                  "    url: pm.environment.get('base_url') + '/auth/send-otp',",
                  "    method: 'POST',",
                  "    header: {",
                  "        'Content-Type': 'application/json'",
                  "    },",
                  "    body: {",
                  "        mode: 'raw',",
                  "        raw: JSON.stringify({",
                  "            identifier: pm.environment.get('test_phone')",
                  "        })",
                  "    }",
                  "};",
                  "",
                  "pm.sendRequest(sendOtpRequest, function(err, res) {",
                  "    if (err) {",
                  "        console.error('Send OTP failed:', err);",
                  "        return;",
                  "    }",
                  "    ",
                  "    console.log('Send OTP response:', res.json());",
                  "    ",
                  "    pm.test('OTP sent successfully', function() {",
                  "        pm.expect(res.code).to.be.oneOf([200, 201]);",
                  "    });",
                  "    ",
                  "    // Step 2: Verify OTP",
                  "    setTimeout(function() {",
                  "        const verifyOtpRequest = {",
                  "            url: pm.environment.get('base_url') + '/auth/verify-otp',",
                  "            method: 'POST',",
                  "            header: {",
                  "                'Content-Type': 'application/json'",
                  "            },",
                  "            body: {",
                  "                mode: 'raw',",
                  "                raw: JSON.stringify({",
                  "                    identifier: pm.environment.get('test_phone'),",
                  "                    otp: '123456' // Test OTP",
                  "                })",
                  "            }",
                  "        };",
                  "        ",
                  "        pm.sendRequest(verifyOtpRequest, function(err, res) {",
                  "            if (err) {",
                  "                console.error('Verify OTP failed:', err);",
                  "                return;",
                  "            }",
                  "            ",
                  "            console.log('Verify OTP response:', res.json());",
                  "            ",
                  "            pm.test('OTP verified successfully', function() {",
                  "                pm.expect(res.code).to.equal(200);",
                  "            });",
                  "            ",
                  "            console.log('âœ… Complete OTP flow test passed!');",
                  "        });",
                  "    }, 1000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}",
              "host": [
                "{{base_url}}"
              ]
            },
            "description": "Runs complete OTP send and verify flow"
          },
          "response": []
        }
      ],
      "description": "Automated test flows"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('Request to:', pm.request.url.toString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test('Response has valid JSON', function() {",
          "    pm.response.to.be.json;",
          "});",
          "",
          "// Log response time",
          "console.log('Response time:', pm.response.responseTime + 'ms');"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "timestamp",
      "value": "",
      "type": "string"
    }
  ]
}